<!-- sldsValidatorIgnore -->
<template>
  <div
    class="slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open"
    style="position: relative"
  >
    <button
      class="slds-button slds-button_icon slds-button_icon-container"
      disabled={isCartDisabled}
      aria-haspopup="true"
      aria-expanded="true"
      title="Show More"
      onclick={toggleCart}
    >
      <lightning-icon icon-name="utility:cart" size="x-small"></lightning-icon>
      <span class="slds-assistive-text">Show More</span>
    </button>

    <template if:true={isCartExpanded}>
      <div
        class="slds-dropdown slds-dropdown_right"
        style="min-width: 40vw; max-width: 100vw"
      >
        <template if:true={productsList.length}>
          <ul class="slds-dropdown__list" role="menu" aria-label="Show More">
            <li
              class="slds-dropdown__item slds-scrollable_y"
              style="max-height: 75vh"
              role="presentation"
            >
              <table
                class="slds-table slds-table_cell-buffer slds-table_bordered slds-no-row-hover"
              >
                <thead>
                  <tr class="slds-line-height_reset">
                    <th></th>
                    <th>
                      <div class="slds-truncate" title="Product Name">
                        Product Name
                      </div>
                    </th>
                    <th>
                      <div class="slds-truncate" title="Amount">Amount</div>
                    </th>
                    <th>
                      <div class="slds-truncate" title="Price">Unit Price</div>
                    </th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <template for:each={productsList} for:item="item">
                    <tr key={item.product.Id}>
                      <td>
                        <img
                          src={item.product.DisplayUrl}
                          style="max-width: 50px"
                        />
                      </td>
                      <td>{item.product.Name}</td>
                      <td>
                        <div
                          style="
                            display: flex;
                            flex-direction: row;
                            align-items: center;
                          "
                        >
                          <lightning-button-icon
                            icon-name="utility:back"
                            onclick={decrementItemAmount}
                            data-product-id={item.product.Id}
                          ></lightning-button-icon>

                          <input
                            class="slds-input"
                            type="number"
                            step="1"
                            value={item.amount}
                            data-product-id={item.product.Id}
                            onchange={updateItemAmount}
                            style="width: 10ch"
                          />

                          <lightning-button-icon
                            icon-name="utility:forward"
                            onclick={incrementItemAmount}
                            data-product-id={item.product.Id}
                          ></lightning-button-icon>
                        </div>
                      </td>
                      <td>{item.total} &euro;</td>
                      <td>
                        <lightning-button-icon
                          icon-name="action:close"
                          size="large"
                          data-product-id={item.product.Id}
                          onclick={deleteItem}
                        ></lightning-button-icon>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </li>
            <li class="slds-dropdown__item" role="presentation">
              <div
                style="
                  display: flex;
                  flex-direction: row;
                  align-items: center;
                  padding: 0.5em;
                "
              >
                <p style="flex-grow: 1; text-align: center">
                  Total Price: <b>{totalPrice} &euro;</b>
                </p>
                <button
                  class="slds-button slds-button_success"
                  style="flex-grow: 1"
                  onclick={navigateToCheckout}
                >
                  Checkout
                </button>
              </div>
            </li>
          </ul>
        </template>
        <template if:false={productsList.length}>
          <ul class="slds-dropdown__list" role="menu" aria-label="Show More">
            <li class="slds-dropdown__item" role="presentation">
              <p style="text-align: center; padding: 0.5em; font-weight: bold">
                No Products Added
              </p>
            </li>
          </ul>
        </template>
      </div>
    </template>

    <template if:true={productsList.length}>
      <p
        style="
          position: absolute;
          top: -0.5em;
          right: -0.5em;
          height: 1em;
          width: 1em;
          z-index: 10;
          font-weight: bold;
          color: rgba(0, 0, 0, 0.5);
        "
      >
        {productsList.length}
      </p>
    </template>
  </div>
</template>
